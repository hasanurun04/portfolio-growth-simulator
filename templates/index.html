<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Growth Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: #252525;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
            padding: 30px;
        }

        .author {
            text-align: center;
            margin-bottom: 5px;
            color: #888888;
            font-size: 14px;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #74b9ff;
        }

        .form-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1 1 200px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #a3c9ff;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #444444;
            border-radius: 5px;
            font-size: 16px;
            background-color: #333333;
            color: #e0e0e0;
        }

        .btn {
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-top: 28px;
        }

        .calculate-btn {
            background-color: #74b9ff;
            color: #222222;
        }

        .calculate-btn:hover {
            background-color: #0984e3;
        }

        .add-btn {
            background-color: #55efc4;
            color: #222222;
        }

        .add-btn:hover {
            background-color: #00b894;
        }

        .remove-btn {
            background-color: #ff7675;
            color: white;
            padding: 5px 10px;
            font-size: 14px;
            margin-top: 10px;
        }

        .remove-btn:hover {
            background-color: #d63031;
        }

        .results {
            margin-top: 30px;
            display: none;
        }

        .results h2 {
            margin-bottom: 20px;
            color: #74b9ff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #444444;
        }

        th {
            background-color: #333333;
            font-weight: bold;
            color: #a3c9ff;
        }

        tr:hover {
            background-color: #333333;
        }

        .chart-container {
            height: 400px;
            margin-top: 30px;
        }

        .summary {
            margin-top: 20px;
            padding: 20px;
            background-color: #333333;
            border-radius: 5px;
            font-weight: bold;
        }

        .error {
            color: #ff7675;
            margin-top: 5px;
            font-size: 14px;
            display: none;
        }

        .profit-periods {
            margin: 20px 0;
        }

        .profit-period {
            background-color: #333333;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            position: relative;
        }

        .profit-period-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .profit-inputs {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .profit-input-group {
            flex: 1 1 180px;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            gap: 20px;
        }

        .save-load-container {
            margin-top: 20px;
            background-color: #333333;
            padding: 20px;
            border-radius: 5px;
        }

        .save-load-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .save-container {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }

        .save-input {
            flex: 1;
            display: flex;
            align-items: stretch;
        }

        .save-input input {
            margin: 0;
        }

        .save-btn {
            background-color: #81ecec;
            color: #222222;
            margin-top: 0;
            white-space: nowrap;
        }

        .save-btn:hover {
            background-color: #00cec9;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal-content {
            background-color: #333333;
            margin: 10% auto;
            padding: 20px;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover {
            color: white;
        }

        .saved-calculation {
            background-color: #444444;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .saved-calculation-name {
            font-weight: bold;
            color: #a3c9ff;
        }

        .saved-calculation-details {
            font-size: 14px;
            color: #cccccc;
        }

        .load-btn {
            background-color: #fdcb6e;
            color: #222222;
            padding: 8px 16px;
            margin-left: 10px;
            margin-top: 0;
            white-space: nowrap;
        }

        .load-btn:hover {
            background-color: #f0932b;
        }

        .delete-btn {
            background-color: #ff7675;
            color: white;
            padding: 8px 16px;
        }

        .delete-btn:hover {
            background-color: #d63031;
        }

        .no-saved {
            text-align: center;
            padding: 20px;
            color: #888888;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .form-group {
                flex: 1 1 100%;
            }

            .profit-input-group {
                flex: 1 1 100%;
            }

            .chart-container {
                height: 300px;
            }

            .button-container {
                flex-direction: column;
            }

            .save-container {
                flex-direction: column;
                align-items: stretch;
            }

            .save-btn, .load-btn {
                margin-top: 10px;
                margin-left: 0;
            }
        }

        .footer {
            max-width: 1000px;
            margin: 20px auto;
            padding: 10px;
            text-align: center;
            color: #888888;
            font-size: 14px;
            line-height: 1.8;
            background-color: #252525;
            border-radius: 10px;
        }

        .footer a {
            color: #74b9ff;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer a:hover {
            color: #0984e3;
            text-decoration: underline;
        }

        .footer img {
            vertical-align: middle;
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            th, td {
                padding: 10px;
                font-size: 14px;
            }

            .chart-container {
                height: 250px;
            }

            .footer {
                font-size: 12px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- <p class="author">by Hasan Urun</p> -->
        <h1>Portfolio Growth Simulator</h1>
        <div class="form-container">
            <div class="form-group">
                <label for="initialAmount">Initial Portfolio (USD)</label>
                <input type="number" id="initialAmount" min="0" step="0.01" placeholder="Enter amount">
                <div id="initialAmountError" class="error">Please enter a valid amount</div>
            </div>
            <div class="form-group">
                <label for="profitPercentage">Daily Profit Percentage (%)</label>
                <input type="number" id="profitPercentage" min="0" step="0.01" placeholder="Enter percentage">
                <div id="profitPercentageError" class="error">Please enter a valid percentage</div>
            </div>
            <div class="form-group">
                <label for="days">Number of Days</label>
                <input type="number" id="days" min="1" step="1" placeholder="Enter days">
                <div id="daysError" class="error">Please enter a valid number of days</div>
            </div>
        </div>

        <div id="profitPeriods" class="profit-periods">

        </div>

        <div class="button-container">
            <button class="btn add-btn" onclick="addProfitPeriod()">Add Different Period</button>
            <button class="btn calculate-btn" onclick="calculateGrowth()">Calculate Growth</button>
        </div>

        <div class="save-load-container">
            <div class="save-load-header">
                <h3>Save & Load Calculations</h3>
            </div>
            <div class="save-container">
                <div class="save-input">
                    <input type="text" id="saveName" placeholder="Enter a name for this calculation">
                </div>
                <button class="btn save-btn" onclick="saveCalculation()">Save Current Calculation</button>
                <button class="btn load-btn" onclick="openLoadModal()">Load Saved Calculation</button>
            </div>
        </div>

        <div id="results" class="results">
            <h2>Portfolio Growth Projection</h2>
            <div class="summary" id="summary">

            </div>

            <div style="max-height: 400px; overflow-y: auto; margin-top: 20px;">
                <table id="growthTable">
                    <thead>
                        <tr>
                            <th>Day</th>
                            <th>Portfolio Value (USD)</th>
                            <th>Daily Profit (USD)</th>
                            <th>Growth from Initial (%)</th>
                            <th>Profit Rate (%)</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">

                    </tbody>
                </table>
            </div>

            <div class="chart-container">
                <canvas id="growthChart"></canvas>
            </div>
        </div>
    </div>

    <div class="footer">
        <a href="https://github.com/hasanurun04/portfolio-growth-simulator">Portfolio Growth Simulator</a> Â© 2025 by <a href="https://www.linkedin.com/in/bayramhasanurun/">Bayram Hasan Urun</a> is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">CC BY-NC-ND 4.0</a><img src="https://mirrors.creativecommons.org/presskit/icons/cc.svg" alt="" style="max-width: 1em;max-height:1em;margin-left: .2em;"><img src="https://mirrors.creativecommons.org/presskit/icons/by.svg" alt="" style="max-width: 1em;max-height:1em;margin-left: .2em;"><img src="https://mirrors.creativecommons.org/presskit/icons/nc.svg" alt="" style="max-width: 1em;max-height:1em;margin-left: .2em;"><img src="https://mirrors.creativecommons.org/presskit/icons/nd.svg" alt="" style="max-width: 1em;max-height:1em;margin-left: .2em;">
    </div>


    <div id="loadModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeLoadModal()">&times;</span>
            <h2>Saved Calculations</h2>
            <div id="savedCalculationsList">

            </div>
        </div>
    </div>

    <script>
        let growthChart = null;
        let profitPeriodCounter = 0;
        let lastCalculationData = null;

        window.onload = function() {
            loadSavedCalculationsFromStorage();
        };

        function validateInputs() {
            const initialAmount = parseFloat(document.getElementById('initialAmount').value);
            const profitPercentage = parseFloat(document.getElementById('profitPercentage').value);
            const days = parseInt(document.getElementById('days').value);

            let isValid = true;

            if (isNaN(initialAmount) || initialAmount <= 0) {
                document.getElementById('initialAmountError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('initialAmountError').style.display = 'none';
            }

            if (isNaN(profitPercentage) || profitPercentage < 0) {
                document.getElementById('profitPercentageError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('profitPercentageError').style.display = 'none';
            }

            if (isNaN(days) || days <= 0 || !Number.isInteger(days)) {
                document.getElementById('daysError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('daysError').style.display = 'none';
            }

            const profitPeriods = document.querySelectorAll('.profit-period');
            profitPeriods.forEach(period => {
                const periodId = period.id.split('-')[2];
                const periodProfit = parseFloat(document.getElementById(`periodProfit-${periodId}`).value);
                const periodDays = parseInt(document.getElementById(`periodDays-${periodId}`).value);

                const profitError = document.getElementById(`periodProfitError-${periodId}`);
                const daysError = document.getElementById(`periodDaysError-${periodId}`);

                if (isNaN(periodProfit) || periodProfit < 0) {
                    profitError.style.display = 'block';
                    isValid = false;
                } else {
                    profitError.style.display = 'none';
                }

                if (isNaN(periodDays) || periodDays <= 0 || !Number.isInteger(periodDays)) {
                    daysError.style.display = 'block';
                    isValid = false;
                } else {
                    daysError.style.display = 'none';
                }
            });

            return isValid;
        }

        function addProfitPeriod() {
            profitPeriodCounter++;
            const profitPeriodsContainer = document.getElementById('profitPeriods');

            const periodDiv = document.createElement('div');
            periodDiv.className = 'profit-period';
            periodDiv.id = `profit-period-${profitPeriodCounter}`;

            periodDiv.innerHTML = `
                <div class="profit-period-header">
                    <h3>Additional Profit Period #${profitPeriodCounter}</h3>
                    <button class="btn remove-btn" onclick="removeProfitPeriod(${profitPeriodCounter})">Remove</button>
                </div>
                <div class="profit-inputs">
                    <div class="profit-input-group">
                        <label for="periodProfit-${profitPeriodCounter}">Daily Profit Percentage (%)</label>
                        <input type="number" id="periodProfit-${profitPeriodCounter}" min="0" step="0.01" placeholder="Enter percentage">
                        <div id="periodProfitError-${profitPeriodCounter}" class="error">Please enter a valid percentage</div>
                    </div>
                    <div class="profit-input-group">
                        <label for="periodDays-${profitPeriodCounter}">Number of Days</label>
                        <input type="number" id="periodDays-${profitPeriodCounter}" min="1" step="1" placeholder="Enter days">
                        <div id="periodDaysError-${profitPeriodCounter}" class="error">Please enter a valid number of days</div>
                    </div>
                </div>
            `;

            profitPeriodsContainer.appendChild(periodDiv);
        }

        function removeProfitPeriod(id) {
            const periodToRemove = document.getElementById(`profit-period-${id}`);
            if (periodToRemove) {
                periodToRemove.remove();
            }
        }

        async function calculateGrowth() {

            if (!validateInputs()) {
                return;
            }

            const initialAmount = parseFloat(document.getElementById('initialAmount').value);
            const defaultProfitPercentage = parseFloat(document.getElementById('profitPercentage').value);
            const defaultDays = parseInt(document.getElementById('days').value);

            const additionalPeriods = [];
            const profitPeriods = document.querySelectorAll('.profit-period');
            profitPeriods.forEach(period => {
                const periodId = period.id.split('-')[2];
                const periodProfit = parseFloat(document.getElementById(`periodProfit-${periodId}`).value);
                const periodDays = parseInt(document.getElementById(`periodDays-${periodId}`).value);
                additionalPeriods.push({ profit: periodProfit, days: periodDays });
            });

            const payload = {
                initialAmount: initialAmount,
                defaultProfitPercentage: defaultProfitPercentage,
                defaultDays: defaultDays,
                additionalPeriods: additionalPeriods
            };

            try {
                const resp = await fetch("/api/calculate", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(payload)
                });

                if (!resp.ok) {
                    const err = await resp.json();
                    alert("Server error: " + (err.error || resp.statusText));
                    return;
                }

                const data = await resp.json();

                const portfolioValues = data.portfolio_values;
                const dailyProfits = data.daily_profits;
                const growthPercentages = data.growth_percentages;
                const profitRates = data.profit_rates;
                const labels = data.labels;
                const totalDays = data.summary.total_days || (labels.length - 1);

                lastCalculationData = {
                    initialAmount: initialAmount,
                    defaultProfitPercentage: defaultProfitPercentage,
                    defaultDays: defaultDays,
                    additionalPeriods: additionalPeriods
                };

                displayResults(portfolioValues, dailyProfits, growthPercentages, profitRates, labels, totalDays);

            } catch (e) {
                alert("Request failed: " + e.message);
            }
        }


        function displayResults(portfolioValues, dailyProfits, growthPercentages, profitRates, labels, totalDays) {
            const initialAmount = parseFloat(document.getElementById('initialAmount').value);

            document.getElementById('results').style.display = 'block';

            const finalValue = portfolioValues[totalDays];
            const totalGrowth = ((finalValue / initialAmount) - 1) * 100;

            document.getElementById('summary').innerHTML = `
                Starting portfolio: $${initialAmount.toFixed(2)}<br>
                Final portfolio after ${totalDays} days: $${finalValue.toFixed(2)}<br>
                Total profit: $${(finalValue - initialAmount).toFixed(2)}<br>
                Total growth: ${totalGrowth.toFixed(2)}%
            `;

            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            for (let day = 0; day <= totalDays; day++) {
                const row = document.createElement('tr');

                const dayCell = document.createElement('td');
                dayCell.textContent = day;
                row.appendChild(dayCell);

                const valueCell = document.createElement('td');
                valueCell.textContent = `$${portfolioValues[day].toFixed(2)}`;
                row.appendChild(valueCell);

                const profitCell = document.createElement('td');
                profitCell.textContent = day === 0 ? '-' : `$${dailyProfits[day].toFixed(2)}`;
                row.appendChild(profitCell);

                const growthCell = document.createElement('td');
                growthCell.textContent = day === 0 ? '0.00%' : `${growthPercentages[day].toFixed(2)}%`;
                row.appendChild(growthCell);

                const rateCell = document.createElement('td');
                rateCell.textContent = day === 0 ? '-' : `${profitRates[day].toFixed(2)}%`;
                row.appendChild(rateCell);

                tableBody.appendChild(row);
            }

            updateChart(labels, portfolioValues);
        }

        function updateChart(labels, portfolioValues) {
            const ctx = document.getElementById('growthChart').getContext('2d');

            if (growthChart) {
                growthChart.destroy();
            }

            Chart.defaults.color = '#e0e0e0';
            Chart.defaults.borderColor = '#444444';

            growthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Portfolio Value (USD)',
                        data: portfolioValues,
                        backgroundColor: 'rgba(116, 185, 255, 0.2)',
                        borderColor: 'rgba(116, 185, 255, 1)',
                        borderWidth: 2,
                        pointRadius: 3,
                        pointBackgroundColor: 'rgba(116, 185, 255, 1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Portfolio Value: $${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Portfolio Growth Over Time'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            title: {
                                display: true,
                                text: 'Portfolio Value (USD)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Day'
                            }
                        }
                    }
                }
            });
        }

        function saveCalculation() {
            if (!lastCalculationData) {
                alert("Please calculate growth before saving.");
                return;
            }

            const saveName = document.getElementById('saveName').value.trim();

            if (!saveName) {
                alert("Please enter a name for this calculation.");
                return;
            }

            let savedCalculations = JSON.parse(localStorage.getItem('portfolioCalculations')) || {};

            const timestamp = new Date().toISOString();

            savedCalculations[saveName] = {
                ...lastCalculationData,
                timestamp: timestamp
            };

            localStorage.setItem('portfolioCalculations', JSON.stringify(savedCalculations));

            alert(`Calculation "${saveName}" saved successfully!`);

            document.getElementById('saveName').value = '';

            updateSavedCalculationsList();
        }

        function loadSavedCalculationsFromStorage() {
            const savedCalculations = JSON.parse(localStorage.getItem('portfolioCalculations')) || {};
            return savedCalculations;
        }

        function updateSavedCalculationsList() {
            const savedCalculations = loadSavedCalculationsFromStorage();
            const listContainer = document.getElementById('savedCalculationsList');

            listContainer.innerHTML = '';

            if (Object.keys(savedCalculations).length === 0) {
                listContainer.innerHTML = '<div class="no-saved">No saved calculations found.</div>';
                return;
            }

            const sortedNames = Object.keys(savedCalculations).sort((a, b) => {
                return new Date(savedCalculations[b].timestamp) - new Date(savedCalculations[a].timestamp);
            });

            sortedNames.forEach(name => {
                const calc = savedCalculations[name];
                const date = new Date(calc.timestamp);
                const formattedDate = `${date.toLocaleDateString()} at ${date.toLocaleTimeString()}`;

                const calcElement = document.createElement('div');
                calcElement.className = 'saved-calculation';

                calcElement.innerHTML = `
                    <div>
                        <div class="saved-calculation-name">${name}</div>
                        <div class="saved-calculation-details">
                            Initial: $${calc.initialAmount} | Base Profit: ${calc.defaultProfitPercentage}% | Days: ${calc.defaultDays}
                            <br>
                            Additional Periods: ${calc.additionalPeriods.length} | Saved on: ${formattedDate}
                        </div>
                    </div>
                    <div>
                        <button class="btn load-btn" onclick="loadCalculation('${name}')">Load</button>
                        <button class="btn delete-btn" onclick="deleteCalculation('${name}')">Delete</button>
                    </div>
                `;

                listContainer.appendChild(calcElement);
            });
        }

        function openLoadModal() {
            updateSavedCalculationsList();
            document.getElementById('loadModal').style.display = 'block';
        }

        function closeLoadModal() {
            document.getElementById('loadModal').style.display = 'none';
        }

        function loadCalculation(name) {
            const savedCalculations = loadSavedCalculationsFromStorage();
            const calc = savedCalculations[name];

            if (!calc) {
                alert(`Calculation "${name}" not found.`);
                return;
            }

            document.getElementById('profitPeriods').innerHTML = '';
            profitPeriodCounter = 0;

            document.getElementById('initialAmount').value = calc.initialAmount;
            document.getElementById('profitPercentage').value = calc.defaultProfitPercentage;
            document.getElementById('days').value = calc.defaultDays;

            calc.additionalPeriods.forEach(period => {
                addProfitPeriod();
                document.getElementById(`periodProfit-${profitPeriodCounter}`).value = period.profit;
                document.getElementById(`periodDays-${profitPeriodCounter}`).value = period.days;
            });

            closeLoadModal();

            calculateGrowth();

            window.scrollTo(0, 0);
        }

        function deleteCalculation(name) {
            if (confirm(`Are you sure you want to delete "${name}"?`)) {
                const savedCalculations = loadSavedCalculationsFromStorage();

                if (savedCalculations[name]) {
                    delete savedCalculations[name];
                    localStorage.setItem('portfolioCalculations', JSON.stringify(savedCalculations));
                    updateSavedCalculationsList();
                }
            }
        }

        window.onclick = function(event) {
            const modal = document.getElementById('loadModal');
            if (event.target === modal) {
                closeLoadModal();
            }
        };
    </script>
</body>
</html>